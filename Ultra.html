<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTF Calculator Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	<style>	
	/* ============ PREMIUM MTF CALCULATOR STYLES ============ */
:root {
    /* Color Variables - Light Theme */
    --background: #f8fafc;
    --surface: #ffffff;
    --surface-hover: #f5f9ff;
    --surface-variant: #f0f4f8;
    --primary: #0050ff;
    --primary-dark: #003ecb;
    --primary-light: #e3f2fd;
    --primary-gradient: linear-gradient(135deg, #0050ff, #4287f5);
    --secondary: #00c2a8;
    --secondary-gradient: linear-gradient(135deg, #00c2a8, #0db4e0);
    --text-primary: #1a2942;
    --text-secondary: #4a5568;
    --text-tertiary: #718096;
    --text-on-primary: #ffffff;
    --border: rgba(226, 232, 240, 0.8);
    --divider: rgba(226, 232, 240, 0.5);
    --success: #10b981;
    --success-light: #d1fae5;
    --error: #ef4444;
    --error-light: #fee2e2;
    --warning: #f59e0b;
    --warning-light: #fef3c7;
    --info: #3b82f6;
    --info-light: #dbeafe;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --sidebar-width: 562px;
    --border-radius-sm: 4px;
    --border-radius: 8px;
    --border-radius-lg: 12px;
    --transition: all 0.3s ease;
}

/* Dark Theme Variables */
.dark-theme {
    --background: #111827;
    --surface: #1f2937;
    --surface-hover: #2d3748;
    --surface-variant: #374151;
    --primary: #3b82f6;
    --primary-dark: #2563eb;
    --primary-light: rgba(59, 130, 246, 0.1);
    --primary-gradient: linear-gradient(135deg, #3b82f6, #60a5fa);
    --secondary: #10b981;
    --secondary-gradient: linear-gradient(135deg, #10b981, #0ea5e9);
    --text-primary: #f9fafb;
    --text-secondary: #e5e7eb;
    --text-tertiary: #9ca3af;
    --text-on-primary: #ffffff;
    --border: rgba(55, 65, 81, 0.8);
    --divider: rgba(55, 65, 81, 0.5);
}

/* Base Styles */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--background);
    color: var(--text-primary);
    line-height: 1.6;
    transition: var(--transition);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

h1, h2, h3, h4, h5, h6 {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    line-height: 1.3;
}

p {
    margin-bottom: 1rem;
}

/* Layout Structure */
.app-wrapper {
    display: flex;
    min-height: 100vh;
}

/* Sidebar */
.app-sidebar {
    width: var(--sidebar-width);
    background: var(--surface);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    position: fixed;
    height: 100vh;
    overflow-y: auto;
    z-index: 10;
    transition: var(--transition);
    box-shadow: var(--shadow);
}

.brand {
    padding: 1.5rem;
    display: flex;
    align-items: center;
    border-bottom: 1px solid var(--divider);
}

.brand-icon {
    font-size: 1.8rem;
    color: var(--primary);
    background: var(--primary-light);
    height: 40px;
    width: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    margin-right: 0.8rem;
}

.brand h1 {
    font-size: 1.3rem;
    margin: 0;
    font-weight: 700;
    color: var(--text-primary);
}

.brand h1 span {
    font-weight: 400;
    opacity: 0.7;
}

.sidebar-content {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
}

.sidebar-content .panel {
    margin: 0;
    border-radius: 0;
    box-shadow: none;
}

.sidebar-content .panel-body {
    padding: 1rem;
}

.sidebar-content .panel-header {
    border-radius: 0;
    padding: 0.8rem 1rem;
    border-bottom: 1px solid var(--divider);
}

.header-with-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-with-controls h3 {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.panel-controls {
    display: flex;
    align-items: center;
}

.icon-btn {
    background: transparent;
    border: none;
    color: var(--text-tertiary);
    font-size: 1rem;
    padding: 0.4rem;
    cursor: pointer;
    border-radius: var(--border-radius-sm);
    transition: var(--transition);
}

.icon-btn:hover {
    background: var(--surface-variant);
    color: var(--primary);
}

.sidebar-footer {
    padding: 1rem;
    font-size: 0.75rem;
    text-align: center;
    color: var(--text-tertiary);
    border-top: 1px solid var(--divider);
}

/* Main Content */
.main-content {
    flex: 1;
    margin-left: var(--sidebar-width);
    width: calc(100% - var(--sidebar-width));
    transition: var(--transition);
}

/* Top Bar */
.top-bar {
    padding: 1rem 2rem;
    background-color: var(--surface);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.page-title h2 {
    font-size: 1.5rem;
    margin-bottom: 0.2rem;
    font-weight: 600;
}

.page-title span {
    font-size: 0.85rem;
    color: var(--text-tertiary);
}

.theme-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.theme-toggle i {
    font-size: 1rem;
    color: var(--text-tertiary);
}

/* Dashboard Layout */
.dashboard {
    padding: 1.5rem 2rem;
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
}

/* Panel Layouts */
.panel {
    background-color: var(--surface);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    margin-bottom: 1.5rem;
    overflow: hidden;
}

/* Input Styles */
.input-grid {
    display: flex;
    flex-direction: column;
    gap: 0.9rem;
}

.input-row {
    display: flex;
    gap: 0.9rem;
}

.input-row .input-group {
    flex: 1;
    min-width: 0;
}

.input-group {
    display: flex;
    flex-direction: column;
    margin-bottom: 0.45rem;
    position: relative;
}

label {
    display: block;
    margin-bottom: 0.36rem;
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-secondary);
}

.with-tooltip {
    display: flex;
    align-items: center;
    gap: 0.3rem;
    position: relative;
}

.tooltip-icon {
    font-size: 0.8rem;
    color: var(--text-tertiary);
    cursor: help;
}

.tooltip-text {
    position: absolute;
    visibility: hidden;
    width: 200px;
    background-color: var(--surface-variant);
    color: var(--text-primary);
    text-align: center;
    border-radius: var(--border-radius-sm);
    padding: 0.5rem;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    transition: opacity 0.3s;
    box-shadow: var(--shadow);
    font-size: 0.75rem;
    font-weight: 400;
    pointer-events: none;
}

.with-tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}

.input-with-icon {
    position: relative;
}

.input-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-tertiary);
    font-size: 0.9rem;
}

input, select {
    width: 100%;
    padding: 0.7rem 1rem;
    padding-left: 2.2rem;
    font-size: 0.95rem;
    border: 1px solid var(--border);
    border-radius: var(--border-radius-sm);
    transition: var(--transition);
    background-color: var(--surface);
    color: var(--text-primary);
    font-family: 'Poppins', sans-serif;
}

input:focus, select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
}

.highlight-input {
    background-color: var(--primary-light);
    border: 1px solid rgba(59, 130, 246, 0.3);
    color: var(--primary);
    font-weight: 500;
}

.amount-display {
    font-size: 0.8rem;
    color: var(--text-tertiary);
    margin-top: 0.4rem;
    font-weight: 500;
}

/* Leverage Slider */
.leverage-slider {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.leverage-slider input[type="range"] {
    flex: 1;
    height: 6px;
    background: var(--divider);
    border-radius: 3px;
    outline: none;
    -webkit-appearance: none;
    appearance: none;
    padding: 0;
    margin: 0;
}

.leverage-slider input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--primary-gradient);
    cursor: pointer;
    transition: all 0.15s ease;
    border: 2px solid #fff;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
}

.leverage-slider input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.2);
}

.leverage-markers {
    display: flex;
    justify-content: space-between;
    margin-top: 0.3rem;
    padding: 0 0.3rem;
    width: calc(100% - 60px);
}

.leverage-markers span {
    font-size: 0.7rem;
    color: var(--text-tertiary);
    text-align: center;
    width: 15px;
}

.numeric-display {
    width: 50px;
    padding: 0.3rem;
    text-align: center;
    border-radius: var(--border-radius-sm);
    border: 1px solid var(--border);
    font-weight: 600;
}

/* Toggle Styles */
.options-container {
    background-color: var(--surface-variant);
    border-radius: var(--border-radius);
    padding: 1.08rem;
    margin-bottom: 1.35rem;
}

.toggle-section {
    margin-bottom: 1.08rem;
}

.toggle-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.72rem;
}

.labeled-toggle {
    justify-content: space-between;
}

.labeled-toggle span {
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--text-secondary);
}

.switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--divider);
    transition: var(--transition);
    border-radius: 24px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: var(--transition);
    border-radius: 50%;
    box-shadow: var(--shadow-sm);
}

input:checked + .slider {
    background-image: var(--primary-gradient);
}

input:checked + .slider:before {
    transform: translateX(26px);
}

.slider.round {
    border-radius: 34px;
}

.slider.round:before {
    border-radius: 50%;
}

/* Rates Section */
.rates-section {
    margin-top: 1.08rem;
}

.rates-container {
    display: flex;
    gap: 0.9rem;
    margin-bottom: 1.08rem;
}

.rate-card {
    flex: 1;
    background: var(--surface);
    border-radius: var(--border-radius);
    padding: 0.9rem;
    display: flex;
    align-items: center;
    box-shadow: var(--shadow-sm);
}

.rate-icon {
    width: 36px;
    height: 36px;
    background: var(--primary-light);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 0.8rem;
    font-size: 1rem;
}

.rate-icon i {
    color: var(--primary);
}

.rate-content {
    flex: 1;
}

.rate-title {
    font-weight: 600;
    font-size: 0.8rem;
    margin-bottom: 0.2rem;
    color: var(--text-secondary);
}

.rate-value {
    font-size: 1rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 0.2rem;
}

.rate-desc {
    color: var(--text-tertiary);
    font-size: 0.7rem;
}

.custom-rate-toggle {
    margin: 1rem 0;
}

.custom-rate-container {
    display: none;
    background-color: var(--surface);
    padding: 1rem;
    border-radius: var(--border-radius-sm);
    margin-top: 0.8rem;
    box-shadow: var(--shadow-sm);
}

/* Buttons */
.icon-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--surface);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: var(--transition);
    color: var(--text-secondary);
}

.icon-btn:hover {
    background-color: var(--surface-hover);
    color: var(--primary);
}

.calculate-container {
    margin-top: 1.5rem;
}

.calculate-btn {
    width: 100%;
    padding: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.8rem;
    background-image: var(--primary-gradient);
    color: var(--text-on-primary);
    border: none;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    font-family: 'Poppins', sans-serif;
    box-shadow: var(--shadow);
    transition: var(--transition);
}

.calculate-btn:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
}

.calculate-btn i {
    font-size: 1.2rem;
}

.export-btn {
    background-color: var(--surface-variant);
}

/* Results Area */
.results-area {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.summary-panel {
    margin-bottom: 0;
}

/* Month Selector */
.month-selector {
    display: flex;
    gap: 0.3rem;
    margin: 0 0 1.5rem;
    overflow-x: auto;
    padding-bottom: 0.5rem;
}

.month-btn {
    padding: 0.4rem 0.8rem;
    font-size: 0.85rem;
    background: var(--surface-variant);
    border: 1px solid var(--border);
    cursor: pointer;
    border-radius: var(--border-radius-sm);
    transition: var(--transition);
    color: var(--text-secondary);
}

.month-btn:hover {
    background: var(--surface-hover);
}

.month-btn.active {
    background-image: var(--primary-gradient);
    color: var(--text-on-primary);
    border-color: var(--primary);
}

/* Summary Grid */
.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1rem;
}

.summary-card {
    background-color: var(--surface-variant);
    border-radius: var(--border-radius);
    overflow: hidden;
}

.summary-header {
    padding: 1rem;
    background-image: var(--secondary-gradient);
    color: white;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.summary-header i {
    font-size: 1rem;
}

.summary-header h4 {
    margin: 0;
    font-size: 0.9rem;
    font-weight: 600;
    color: white;
}

.summary-content {
    padding: 1rem;
}

.data-row {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--divider);
}

.data-label {
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--text-secondary);
}

.data-value {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-primary);
}

.highlight-value {
    color: var(--success);
    font-size: 1rem;
}

/* Table Styles */
.table-container {
    max-height: 500px;
    overflow-y: auto;
    border-radius: var(--border-radius-sm);
}

.details-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
}

.details-table th,
.details-table td {
    padding: 0.8rem;
    text-align: right;
    border-bottom: 1px solid var(--divider);
}

.details-table th {
    background-color: var(--surface-variant);
    font-weight: 600;
    position: sticky;
    top: 0;
    z-index: 1;
    color: var(--text-secondary);
}

.details-table tr:hover {
    background-color: var(--surface-hover);
}

/* Status Colors */
.profit {
    color: var(--success);
}

.loss {
    color: var(--error);
}

.difference {
    color: var(--info);
}

.multiplier {
    color: var(--warning);
}

.leverage-column {
    background-color: var(--surface-variant);
    border-left: 2px solid var(--divider);
    color: var(--text-tertiary);
    font-size: 0.85rem;
    display: none;
}

.leverage-column.show {
    display: table-cell;
}

.separator {
    color: var(--text-tertiary);
    padding: 0 5px;
}

.rate-reduction-row {
    background-color: rgba(255, 243, 224, 0.1);
    border-left: 2px solid var(--warning);
}

.rate-reduction-amount {
    color: var(--warning) !important;
    font-weight: 600;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .dashboard {
        grid-template-columns: 1fr;
    }
    
    .input-panel {
        height: auto;
    }
    
    .input-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
}

@media (max-width: 768px) {
    .app-sidebar {
        width: 80px;
        transition: width 0.3s ease;
    }
    
    .brand h1, .menu-item span, .sidebar-footer p {
        display: none;
    }
    
    .brand {
        justify-content: center;
        padding: 1.5rem 0;
    }
    
    .brand-icon {
        margin-right: 0;
    }
    
    .menu-item {
        justify-content: center;
        padding: 0.8rem 0;
    }
    
    .menu-item i {
        margin-right: 0;
        font-size: 1.4rem;
    }
    
    .main-content {
        margin-left: 80px;
        width: calc(100% - 80px);
    }
    
    .dashboard {
        padding: 1rem;
    }
    
    .top-bar {
        padding: 1rem;
    }
}

@media (max-width: 576px) {
    .rates-container, .summary-grid {
        grid-template-columns: 1fr;
    }
    
    .panel-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
    
    .panel-controls {
        width: 100%;
        justify-content: flex-end;
    }
}

/* Remove number input spinners */
input[type=number]::-webkit-inner-spin-button, 
input[type=number]::-webkit-outer-spin-button { 
    -webkit-appearance: none; 
    margin: 0; 
}

input[type=number] {
    -moz-appearance: textfield;
    appearance: textfield;
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.panel {
    animation: fadeIn 0.5s ease forwards;
}

	</style>
</head>
<body>
    <div class="app-wrapper">
        <div class="app-sidebar">
            <div class="brand">
                <i class="fas fa-chart-line brand-icon"></i>
                <h1>MTF<span>calculator</span></h1>
            </div>
            <div class="sidebar-content">
                <div class="panel input-panel">
                    <div class="panel-header">
                        <div class="header-with-controls">
                            <h3><i class="fas fa-sliders-h"></i> Investment Parameters</h3>
                            <div class="panel-controls">
                                <button class="icon-btn" onclick="resetForm()">
                                    <i class="fas fa-undo-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel-body">
                        <div class="input-grid">
                            <div class="input-row">
                                <div class="input-group balance-group">
                                    <label class="with-tooltip">
                                        Total Balance (₹)
                                        <i class="fas fa-info-circle tooltip-icon"></i>
                                        <span class="tooltip-text">Your total available balance</span>
                                    </label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-rupee-sign input-icon"></i>
                                        <input type="number" id="totalBalance" value="120000" min="0" step="10000" max="1000000000000" class="highlight-input">
                                    </div>
                                    <div id="totalBalanceDisplay" class="amount-display"></div>
                                </div>
                                
                                <div class="input-group">
                                    <label>Own Amount (₹)</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-wallet input-icon"></i>
                                        <input type="number" id="ownAmount" value="50000" min="1000" max="1000000000000">
                                    </div>
                                    <div id="amountDisplay" class="amount-display"></div>
                                </div>
                            </div>
                            
                            <div class="input-row">
                                <div class="input-group">
                                    <label>Buy Price (₹)</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-tags input-icon"></i>
                                        <input type="number" id="buyPrice" value="100" min="0.01" step="0.01" max="50000">
                                    </div>
                                </div>
                                
                                <div class="input-group">
                                    <label>Sell Price (₹)</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-tag input-icon"></i>
                                        <input type="number" id="sellPrice" value="105" min="0.01" step="0.01" max="50000">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="input-row">
                                <div class="input-group">
                                    <label>Leverage (1-5)</label>
                                    <div class="leverage-slider">
                                        <input type="range" min="1" max="5" step="1" value="5" id="leverageSlider">
                                        <input type="number" id="leverage" value="5" min="1" max="5" step="1" class="numeric-display">
                                    </div>
                                    <div class="leverage-markers">
                                        <span>1x</span>
                                        <span>2x</span>
                                        <span>3x</span>
                                        <span>4x</span>
                                        <span>5x</span>
                                    </div>
                                </div>
                                
                                <div class="input-group">
                                    <label id="maxPeriodLabel">Max Months</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-calendar-alt input-icon"></i>
                                        <input type="number" id="maxPeriod" value="12" min="1" max="12">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="options-container">
                            <div class="toggle-section">
                                <div class="toggle-wrapper labeled-toggle">
                                    <span>Monthly</span>
                                    <label class="switch">
                                        <input type="checkbox" id="dayModeToggle">
                                        <span class="slider round"></span>
                                    </label>
                                    <span>Daily</span>
                                </div>
                            </div>
                            
                            <div class="rates-section">
                                <div class="rates-container">
                                    <div class="rate-card">
                                        <div class="rate-icon"><i class="fas fa-percentage"></i></div>
                                        <div class="rate-content">
                                            <div class="rate-title">Interest Rate</div>
                                            <div class="rate-value" id="currentRate">0%</div>
                                            <div class="rate-desc">Based on borrowed amount</div>
                                        </div>
                                    </div>
                                    
                                    <div class="rate-card">
                                        <div class="rate-icon"><i class="fas fa-receipt"></i></div>
                                        <div class="rate-content">
                                            <div class="rate-title">GST Rate</div>
                                            <div class="rate-value">18%</div>
                                            <div class="rate-desc">Applied on interest amount</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="toggle-wrapper custom-rate-toggle labeled-toggle">
                                    <span>Standard</span>
                                    <label class="switch">
                                        <input type="checkbox" id="customRateToggle">
                                        <span class="slider round"></span>
                                    </label>
                                    <span>Custom</span>
                                </div>
                                
                                <div id="customRateContainer" class="custom-rate-container">
                                    <label>Custom Interest Rate (%)</label>
                                    <div class="input-with-icon">
                                        <i class="fas fa-percentage input-icon"></i>
                                        <input type="number" id="customRate" value="12.49" min="0" max="25" step="0.01">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="calculate-container">
                            <button class="calculate-btn" onclick="calculateMTF()">
                                <i class="fas fa-calculator"></i>
                                <span>Calculate Returns</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="top-bar">
                <div class="page-title">
                    <h2>Margin Trading Facility</h2>
                    <span>Calculate your potential profits with precision</span>
                </div>
                <div class="lite-mode-wrapper">
                    <button id="switchToLiteBtn" class="lite-mode-btn">
                        <i class="fas fa-bolt-lightning"></i>
                        <span class="lite-text">LITE MODE</span>
                    </button>
                </div>
                
                <style>
                .lite-mode-wrapper {
                    margin-left: auto;
                    margin-right: 15px;
                }
                
                .lite-mode-btn {
                    display: flex;
                    align-items: center;
                    background: linear-gradient(to right, var(--secondary), var(--info));
                    color: white;
                    border: none;
                    border-radius: var(--border-radius);
                    padding: 8px 16px;
                    font-size: 12px;
                    font-weight: 600;
                    cursor: pointer;
                    position: relative;
                    overflow: hidden;
                    transition: all 0.3s;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                    box-shadow: 0 3px 6px rgba(0, 194, 168, 0.2);
                }
                
                .lite-mode-btn::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: -100%;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                    transition: 0.5s;
                }
                
                .lite-mode-btn:hover::before {
                    left: 100%;
                }
                
                .lite-mode-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 5px 15px rgba(0, 194, 168, 0.3);
                }
                
                .lite-mode-btn i {
                    margin-right: 8px;
                    font-size: 14px;
                    transition: transform 0.3s;
                }
                
                .lite-mode-btn:hover i {
                    transform: rotate(-20deg);
                }
                
                .lite-mode-btn .lite-text {
                    position: relative;
                }
                
                /* If Font Awesome doesn't have bolt-lightning, use regular bolt */
                .fa-bolt-lightning::before {
                    content: "\f0e7";
                }
                </style>
                <div class="top-controls">
                    <div class="theme-toggle">
                        <i class="fas fa-sun"></i>
                        <label class="switch">
                            <input type="checkbox" id="themeToggle">
                            <span class="slider round"></span>
                        </label>
                        <i class="fas fa-moon"></i>
                    </div>
                </div>
            </div>
            
            <div class="dashboard">
                <div class="results-area">
                    <div class="panel summary-panel" id="resultSummary" style="display:none">
                        <div class="panel-header">
                            <h3><i class="fas fa-chart-pie"></i> Summary Results</h3>
                        </div>
                        <div class="panel-body">
                            <div id="monthSelector" class="month-selector"></div>
                            
                            <div class="summary-grid">
                                <div class="summary-card">
                                    <div class="summary-header">
                                        <i class="fas fa-coins"></i>
                                        <h4>Investment Details</h4>
                                    </div>
                                    <div class="summary-content">
                                        <div class="data-row">
                                            <div class="data-label">Total Buying Power</div>
                                            <div class="data-value" id="totalInvestment">₹0</div>
                                        </div>
                                        <div class="data-row">
                                            <div class="data-label">Borrowed Amount</div>
                                            <div class="data-value" id="fundedAmount">₹0</div>
                                        </div>
                                        <div class="data-row">
                                            <div class="data-label">Effective Borrowed Amount</div>
                                            <div class="data-value" id="effectiveBorrowedAmount">₹0</div>
                                        </div>
                                        <div class="data-row">
                                            <div class="data-label">Leftover Balance</div>
                                            <div class="data-value" id="leftoverBalance">₹0</div>
                                        </div>
                                        <div class="data-row rate-reduction-row" style="display:none">
                                            <div class="data-label">Add to reduce MTF rate</div>
                                            <div class="data-value rate-reduction-amount" id="rateReductionAmount">₹0</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="summary-card">
                                    <div class="summary-header">
                                        <i class="fas fa-tag"></i>
                                        <h4>Trade Details</h4>
                                    </div>
                                    <div class="summary-content">
                                        <div class="data-row">
                                            <div class="data-label">Units Purchased</div>
                                            <div class="data-value" id="quantity">0</div>
                                        </div>
                                        <div class="data-row">
                                            <div class="data-label">Interest Rate</div>
                                            <div class="data-value" id="interestRate">0%</div>
                                        </div>
                                        <div class="data-row">
                                            <div class="data-label">Other Charges</div>
                                            <div class="data-value" id="otherChargesDisplay">₹0</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="summary-card">
                                    <div class="summary-header">
                                        <i class="fas fa-chart-line"></i>
                                        <h4>Profit Analysis</h4>
                                    </div>
                                    <div class="summary-content">
                                        <div class="data-row" id="noLeverageRow" style="display:none">
                                            <div class="data-label">Without Leverage</div>
                                            <div class="data-value" id="noLeverageDisplay">₹0</div>
                                        </div>
                                        <div class="data-row" id="diffRow" style="display:none">
                                            <div class="data-label">Leverage Advantage</div>
                                            <div class="data-value" id="leverageDiffDisplay">0%</div>
                                        </div>
                                        <div class="data-row">
                                            <div class="data-label">Breakeven Price</div>
                                            <div class="data-value" id="breakevenPrice">₹0</div>
                                        </div>
                                        <div class="data-row">
                                            <div class="data-label">Gross Profit</div>
                                            <div class="data-value" id="grossProfit">₹0</div>
                                        </div>
                                        <div class="data-row">
                                            <div class="data-label">Paper Profit</div>
                                            <div class="data-value" id="paperProfit">₹0</div>
                                        </div>
                                        <div class="data-row">
                                            <div class="data-label">Net Profit</div>
                                            <div class="data-value highlight-value" id="netProfit">₹0</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel details-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-table"></i> Detailed Results</h3>
                            <div class="panel-controls">
                                <button class="icon-btn export-btn">
                                    <i class="fas fa-file-export"></i>
                                </button>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="table-container">
                                <table class="details-table">
                                    <thead>
                                        <tr id="tableHeader">
                                            <th>Month</th>
                                            <th>MTF Charges</th>
                                            <th>GST</th>
                                            <th>Other Charges</th>
                                            <th class="leverage-column" id="leverageColumnHeader">Net Profit (Returns %)</th>
                                            <th>Gross Profit</th>
                                            <th>Paper Profit</th>
                                            <th>Net Profit</th>
                                            <th>Returns %</th>
                                        </tr>
                                    </thead>
                                    <tbody id="result"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Connect leverage slider to input field
        document.addEventListener('DOMContentLoaded', function() {
            const leverageSlider = document.getElementById('leverageSlider');
            const leverageInput = document.getElementById('leverage');
            
            // Update input when slider changes
            leverageSlider.addEventListener('input', function() {
                leverageInput.value = this.value;
                updateInterestRateDisplay();
            });
            
            // Update slider when input changes
            leverageInput.addEventListener('input', function() {
                leverageSlider.value = this.value;
                updateInterestRateDisplay();
            });
            
            // Theme toggle functionality
            const themeToggle = document.getElementById('themeToggle');
            const body = document.body;
            
            themeToggle.addEventListener('change', function() {
                if(this.checked) {
                    body.classList.add('dark-theme');
                } else {
                    body.classList.remove('dark-theme');
                }
            });
            
            // Lite mode button functionality
            const switchToLiteBtn = document.getElementById('switchToLiteBtn');
            
            switchToLiteBtn.addEventListener('click', function() {
                // Add transition animation
                this.style.transform = 'scale(0.95)';
                this.style.opacity = '0.9';
                
                // Add particles effect (simplified version)
                const particles = document.createElement('div');
                particles.classList.add('particles-container');
                document.body.appendChild(particles);
                
                for (let i = 0; i < 8; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    particle.style.left = (Math.random() * 100) + '%';
                    particle.style.top = (Math.random() * 100) + '%';
                    particle.style.animationDelay = (Math.random() * 0.5) + 's';
                    particles.appendChild(particle);
                }
                
                // Redirect after animation
                setTimeout(function() {
                    window.location.href = 'Simple.html';
                }, 500);
            });
            
            // Add particle styles
            const particleStyle = document.createElement('style');
            particleStyle.innerHTML = `
                .particles-container {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    pointer-events: none;
                    z-index: 9999;
                }
                
                .particle {
                    position: absolute;
                    width: 8px;
                    height: 8px;
                    background: var(--secondary);
                    border-radius: 50%;
                    opacity: 0;
                    animation: particle-animation 0.8s ease-out forwards;
                }
                
                @keyframes particle-animation {
                    0% {
                        transform: scale(0);
                        opacity: 1;
                    }
                    100% {
                        transform: scale(1.5) translateY(-20px);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(particleStyle);
        });
		// Define constants for interest rate slabs (in rupees)
const SLAB_1_MAX = 500000;       // 5 lakhs
const SLAB_2_MAX = 1000000;      // 10 lakhs
const SLAB_3_MAX = 2500000;      // 25 lakhs
const SLAB_4_MAX = 5000000;      // 50 lakhs

// Define maximum value limits
const MAX_BALANCE_OWN_AMOUNT = 1000000000000; // 10,000 crores (₹10 lakh crores)
const MAX_PRICE = 50000;          // ₹50,000 per share
const MAX_DAYS = 60;              // 60 days maximum
const MAX_MONTHS = 24;            // 24 months maximum

let calculationResults = [];
const customRateToggle = document.getElementById('customRateToggle');
const customRateContainer = document.getElementById('customRateContainer');
const currentRateDisplay = document.getElementById('currentRate');
const dayModeToggle = document.getElementById('dayModeToggle');
const leverageColumnHeader = document.getElementById('leverageColumnHeader');
let noLeverageReturnPercent = 0; // Store this globally for comparisons
let noLeverageNetProfit = 0;

// Add input validation to prevent negative values and zeros
document.addEventListener('DOMContentLoaded', function() {
    // Get all numeric input elements
    const numericInputs = document.querySelectorAll('input[type="number"]');
    
    numericInputs.forEach(input => {
        // Prevent typing negative sign
        input.addEventListener('keydown', function(e) {
            if (e.key === '-' || e.keyCode === 189) {
                e.preventDefault();
            }
        });
        
        // Validate on input changes
        input.addEventListener('input', function() {
            let value = this.value;
            
            // Remove any negative signs that might be pasted
            if (value.includes('-')) {
                value = value.replace('-', '');
                this.value = value;
            }
            
            // Handle zero inputs
            if (value === '0' || parseFloat(value) === 0) {
                this.value = '';
            }
            
            // Apply maximum value limits based on input field
            const numValue = parseFloat(value);
            if (!isNaN(numValue)) {
                // Apply specific limits based on input field ID
                if (this.id === 'totalBalance' || this.id === 'ownAmount') {
                    if (numValue > MAX_BALANCE_OWN_AMOUNT) {
                        this.value = MAX_BALANCE_OWN_AMOUNT.toString();
                    }
                } else if (this.id === 'buyPrice' || this.id === 'sellPrice') {
                    if (numValue > MAX_PRICE) {
                        this.value = MAX_PRICE.toString();
                    }
                } else if (this.id === 'maxPeriod') {
                    const isDayMode = document.getElementById('dayModeToggle').checked;
                    const maxAllowed = isDayMode ? MAX_DAYS : MAX_MONTHS;
                    if (numValue > maxAllowed) {
                        this.value = maxAllowed.toString();
                    }
                }
            }
            
            // Enforce leverage limits (1-5)
            if (this.id === 'leverage') {
                const val = parseFloat(value);
                if (!isNaN(val) && val > 5) {
                    this.value = '5';
                }
                
                // Make sure to update interest rate when leverage changes
                updateInterestRateDisplay();
            }
            
            // Enforce custom rate maximum (25%)
            if (this.id === 'customRate') {
                const val = parseFloat(value);
                if (!isNaN(val) && val > 25) {
                    this.value = '25';
                }
            }
            
            // Update interest rate when own amount changes
            if (this.id === 'ownAmount') {
                updateAmountDisplay();
                updateInterestRateDisplay();
            }
            
            // Update total balance display when total balance changes
            if (this.id === 'totalBalance') {
                updateTotalBalanceDisplay();
            }
        });
    });
    
    // Create the amount display div
    const amountDisplayDiv = document.createElement('div');
    amountDisplayDiv.id = 'amountDisplay';
    
    // Improved styling - green color, better positioning, clear separation
    amountDisplayDiv.style.fontSize = '12px';
    amountDisplayDiv.style.color = '#2e7d32'; // Green color
    amountDisplayDiv.style.fontWeight = '500';
    amountDisplayDiv.style.padding = '8px 2px';
    amountDisplayDiv.style.margin = '15px 0 8px 0';
    amountDisplayDiv.style.borderBottom = '1px dotted #ddd';
    
    // Get the Own Amount input and insert the display AFTER the parent div
    const ownAmountInput = document.getElementById('ownAmount');
    const ownAmountParent = ownAmountInput.parentElement;
    
    // Insert after the own amount input div
    ownAmountParent.parentNode.insertBefore(amountDisplayDiv, ownAmountParent.nextSibling);
    
    // Create amount display for Total Balance
    const totalBalanceInput = document.getElementById('totalBalance');
    const totalBalanceParent = totalBalanceInput.parentNode;
    
    const totalBalanceDisplayDiv = document.createElement('div');
    totalBalanceDisplayDiv.id = 'totalBalanceDisplay';
    
    // Style the total balance display
    totalBalanceDisplayDiv.style.fontSize = '12px';
    totalBalanceDisplayDiv.style.color = '#F48FB1'; // Softer pink color
    totalBalanceDisplayDiv.style.fontWeight = '500';
    totalBalanceDisplayDiv.style.padding = '8px 2px';
    totalBalanceDisplayDiv.style.margin = '15px 0 8px 0';
    totalBalanceDisplayDiv.style.borderBottom = '1px dotted #ddd';
    
    // Add event listener for updating the display
    totalBalanceInput.addEventListener('input', updateTotalBalanceDisplay);
    totalBalanceInput.addEventListener('change', updateTotalBalanceDisplay);
    
    // Insert the display element after the input's parent div
    totalBalanceParent.parentNode.insertBefore(totalBalanceDisplayDiv, totalBalanceParent.nextSibling);
    
    // Initial displays
    updateAmountDisplay();
    updateTotalBalanceDisplay();
    updateInterestRateDisplay();

    // Set up day/month toggle
    dayModeToggle.addEventListener('change', function() {
        const maxPeriodLabel = document.getElementById('maxPeriodLabel');
        const maxPeriodInput = document.getElementById('maxPeriod');
        const tableContainer = document.querySelector('.table-container');
        
        if (this.checked) {
            // Day mode
            maxPeriodLabel.textContent = 'Max Days:';
            maxPeriodInput.max = MAX_DAYS; // Still use MAX_DAYS as upper limit
            maxPeriodInput.value = 31; // Keep original default of 31 days
            // Update table header and increase table height for more visible rows
            document.querySelector('#tableHeader th:first-child').textContent = 'Day';
            tableContainer.style.maxHeight = '900px'; // Increased to show all rows
        } else {
            // Month mode
            maxPeriodLabel.textContent = 'Max Months:';
            maxPeriodInput.max = MAX_MONTHS; // Still use MAX_MONTHS as upper limit
            maxPeriodInput.value = 12; // Keep original default of 12 months
            // Update table header and reset table height
            document.querySelector('#tableHeader th:first-child').textContent = 'Month';
            tableContainer.style.maxHeight = '400px'; // Reset to original height
        }
        
        // Automatically recalculate when toggling views
        calculateMTF();
    });
    
    // Automatically calculate with default values when page loads
    document.getElementById('leverage').value = 5;
    calculateMTF();
});

// Format amount to words
function formatAmountInWords(amount) {
    if (amount <= 0) return "";
    
    if (amount >= 10000000) { // Crore
        const crores = Math.floor(amount / 10000000);
        const remainder = amount % 10000000;
        
        if (remainder === 0) {
            return `${crores} crore${crores > 1 ? 's' : ''}`;
        } else {
            const lakhs = formatLakhs(remainder);
            return `${crores} crore${crores > 1 ? 's' : ''} ${lakhs}`;
        }
    } else {
        return formatLakhs(amount);
    }
}

function formatLakhs(amount) {
    if (amount >= 100000) { // Lakh
        const lakhs = Math.floor(amount / 100000);
        const remainder = amount % 100000;
        
        if (remainder === 0) {
            return `${lakhs} lakh${lakhs > 1 ? 's' : ''}`;
        } else if (remainder === 1) {
            return `${lakhs} lakh${lakhs > 1 ? 's' : ''} and 1 rupee`;
        } else if (remainder < 1000) {
            return `${lakhs} lakh${lakhs > 1 ? 's' : ''} and ${remainder} rupees`;
        } else {
            const thousands = Math.floor(remainder / 1000);
            const rupees = remainder % 1000;
            if (rupees === 0) {
                return `${lakhs} lakh${lakhs > 1 ? 's' : ''} and ${thousands} thousand`;
            } else {
                return `${lakhs} lakh${lakhs > 1 ? 's' : ''} and ${thousands} thousand ${rupees} rupees`;
            }
        }
    } else if (amount >= 1000) { // Thousand
        const thousands = Math.floor(amount / 1000);
        const rupees = amount % 1000;
        
        if (rupees === 0) {
            return `${thousands} thousand`;
        } else {
            return `${thousands} thousand ${rupees} rupees`;
        }
    } else {
        return `${amount} rupees`;
    }
}

function updateAmountDisplay() {
    const ownAmountInput = document.getElementById('ownAmount');
    const amountDisplayDiv = document.getElementById('amountDisplay');
    const amount = parseFloat(ownAmountInput.value);
    if (!isNaN(amount) && amount > 0) {
        amountDisplayDiv.textContent = ' ' + formatAmountInWords(amount);
    } else {
        amountDisplayDiv.textContent = '';
    }
}

function updateTotalBalanceDisplay() {
    const totalBalanceInput = document.getElementById('totalBalance');
    const totalBalanceDisplayDiv = document.getElementById('totalBalanceDisplay');
    const amount = parseFloat(totalBalanceInput.value);
    if (!isNaN(amount) && amount > 0) {
        totalBalanceDisplayDiv.textContent = ' ' + formatAmountInWords(amount);
    } else {
        totalBalanceDisplayDiv.textContent = '';
    }
}

// Function to update interest rate display based on leverage and own amount
function updateInterestRateDisplay() {
    if (customRateToggle.checked) {
        currentRateDisplay.textContent = 'Custom Rate Enabled';
        return;
    }
    
    const leverage = parseFloat(document.getElementById('leverage').value);
    
    // If leverage is 1, no borrowing occurs, so interest rate is 0
    if (isNaN(leverage) || leverage === 1) {
        currentRateDisplay.textContent = 'Current Rate: 0%';
        return;
    }
    
    // For leverage > 1, determine rate based on borrowed amount
    const ownAmount = parseFloat(document.getElementById('ownAmount').value);
    const borrowedAmount = ownAmount * (leverage - 1); // Calculate the borrowed amount
    
    // Also calculate effective borrowed amount
    const totalBalance = parseFloat(document.getElementById('totalBalance').value);
    const leftoverBalance = Math.max(0, isNaN(totalBalance) ? 0 : totalBalance - ownAmount);
    const effectiveBorrowedAmount = Math.max(0, borrowedAmount - leftoverBalance);
    
    let rate;
    
    if (isNaN(ownAmount) || ownAmount <= 0 || effectiveBorrowedAmount <= 0) {
        rate = 0; // No interest when there's no effective borrowing
    }
    else if (effectiveBorrowedAmount < SLAB_1_MAX || Math.abs(effectiveBorrowedAmount - SLAB_1_MAX) < 0.01) {
        rate = 12.49;
    } 
    else if (effectiveBorrowedAmount > SLAB_1_MAX && effectiveBorrowedAmount <= SLAB_2_MAX) {
        rate = 13.49;
    } 
    else if (effectiveBorrowedAmount > SLAB_2_MAX && effectiveBorrowedAmount <= SLAB_3_MAX) {
        rate = 14.49;
    } 
    else if (effectiveBorrowedAmount > SLAB_3_MAX && effectiveBorrowedAmount <= SLAB_4_MAX) {
        rate = 15.49;
    } 
    else {
        rate = 16.49;
    }
    
    currentRateDisplay.textContent = `Current Rate: ${rate}%`;
}

customRateToggle.addEventListener('change', function() {
    customRateContainer.style.display = this.checked ? 'block' : 'none';
    
    if (this.checked) {
        currentRateDisplay.textContent = 'Custom Rate Enabled';
    } else {
        updateInterestRateDisplay();
    }
});

// Helper function to generate advantage HTML
function generateAdvantageHTML(leveragedReturn, noLeveragedReturn) {
    const returnDiff = leveragedReturn - noLeveragedReturn;
    let multiplier = Math.abs(leveragedReturn / noLeveragedReturn).toFixed(1);
    
    // If either return is near zero or negative, handle the multiplier differently
    if (Math.abs(noLeveragedReturn) < 0.1 || 
        (leveragedReturn < 0 && noLeveragedReturn > 0) || 
        (leveragedReturn > 0 && noLeveragedReturn < 0)) {
        multiplier = "N/A";
    } else {
        multiplier = multiplier + "x";
    }
    
    const diffClass = returnDiff >= 0 ? 'difference' : 'loss';
    // Use the appropriate color for the multiplier based on whether the advantage is positive or negative
    const multiplierClass = returnDiff >= 0 ? 'multiplier' : 'difference';
    
    return `<span class="${diffClass}">${returnDiff.toLocaleString('en-IN', {maximumFractionDigits: 2})}%</span> <span class="${multiplierClass}">≈ ${multiplier}</span>`;
}

function selectMonth(period) {
    if (!calculationResults.length) return;
    
    // Update active month/day button
    document.querySelectorAll('.month-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.getElementById(`period-${period}`).classList.add('active');
    
    // Update the summary values for the selected period
    const result = calculationResults[period-1];
    document.getElementById('grossProfit').textContent = '₹' + result.grossProfit.toLocaleString('en-IN', {maximumFractionDigits: 2});
    document.getElementById('paperProfit').textContent = '₹' + result.paperProfit.toLocaleString('en-IN', {maximumFractionDigits: 2});
    document.getElementById('netProfit').textContent = '₹' + result.netProfit.toLocaleString('en-IN', {maximumFractionDigits: 2});
    document.getElementById('breakevenPrice').textContent = '₹' + result.breakevenPrice.toLocaleString('en-IN', {maximumFractionDigits: 2});
    
    // Make sure to update the interest rate display from the result
    document.getElementById('interestRate').textContent = result.interestRate.toFixed(2) + '%';
    
    // Update the leverage advantage for the current period
    if (document.getElementById('diffRow').style.display !== 'none') {
        const leverageDiffDisplay = document.getElementById('leverageDiffDisplay');
        leverageDiffDisplay.innerHTML = generateAdvantageHTML(result.returnPercent, noLeverageReturnPercent);
    }
    
    // Color code the profit/loss
    document.getElementById('grossProfit').className = result.grossProfit >= 0 ? 'profit' : 'loss';
    document.getElementById('paperProfit').className = result.paperProfit >= 0 ? 'profit' : 'loss';
    document.getElementById('netProfit').className = result.netProfit >= 0 ? 'profit' : 'loss';
}

function calculateMTF() {
    const ownAmount = parseFloat(document.getElementById('ownAmount').value);
    const buyPrice = parseFloat(document.getElementById('buyPrice').value);
    const sellPrice = parseFloat(document.getElementById('sellPrice').value);
    const leverage = parseFloat(document.getElementById('leverage').value);
    const totalBalance = parseFloat(document.getElementById('totalBalance').value);
    const maxPeriod = parseInt(document.getElementById('maxPeriod').value);
    const useCustomRate = document.getElementById('customRateToggle').checked;
    const isDayMode = document.getElementById('dayModeToggle').checked;
    
    // Silent validation - no alert popups
    if (isNaN(leverage) || leverage < 1 || isNaN(ownAmount) || isNaN(buyPrice) || isNaN(sellPrice) || 
        ownAmount <= 0 || buyPrice <= 0 || sellPrice <= 0 || isNaN(totalBalance) || totalBalance < 0) {
        return; // Just stop execution, no error messages
    }
    
    // Show or hide leverage column based on leverage value
    if (leverage > 1) {
        leverageColumnHeader.classList.add('show');
        document.getElementById('noLeverageRow').style.display = 'table-row';
        document.getElementById('diffRow').style.display = 'table-row';
    } else {
        leverageColumnHeader.classList.remove('show');
        document.getElementById('noLeverageRow').style.display = 'none';
        document.getElementById('diffRow').style.display = 'none';
    }
    
    const tradeValue = ownAmount * leverage;
    const fundedAmount = tradeValue - ownAmount;
    
    // Calculate leftover balance and effective borrowed amount
    const leftoverBalance = Math.max(0, totalBalance - ownAmount);
    const effectiveBorrowedAmount = Math.max(0, fundedAmount - leftoverBalance);
    
    // Debug logging
    console.log('Total Balance:', totalBalance);
    console.log('Own Amount:', ownAmount);
    console.log('Funded Amount:', fundedAmount);
    console.log('Leftover Balance:', leftoverBalance);
    console.log('Effective Borrowed Amount:', effectiveBorrowedAmount);
    console.log('SLAB_1_MAX:', SLAB_1_MAX);
    
    const exactQuantity = tradeValue / buyPrice;
    const quantity = Math.floor(exactQuantity);
    const totalInvestment = quantity * buyPrice;
    const otherCharges = tradeValue * (300 / 100000);
    
    // Calculate the no-leverage scenario once (doesn't change with period)
    const noLeverageQuantity = Math.floor(ownAmount / buyPrice);
    const noLeverageGrossProfit = (sellPrice - buyPrice) * noLeverageQuantity;
    const noLeverageOtherCharges = ownAmount * (300 / 100000);
    noLeverageNetProfit = noLeverageGrossProfit - noLeverageOtherCharges;
    noLeverageReturnPercent = (noLeverageNetProfit / ownAmount) * 100;
    
    let interestRate;
    if (useCustomRate) {
        interestRate = parseFloat(document.getElementById('customRate').value);
        if (isNaN(interestRate) || interestRate < 0) {
            return; // Silent fail - no error message
        }
    } else {
        // If leverage is 1, no borrowing occurs, so interest rate is 0
        if (leverage === 1 || effectiveBorrowedAmount <= 0) {
            interestRate = 0;
        } else {
            // Only apply slab-based interest rates when actually borrowing (leverage > 1)
            console.log('Determining interest rate slab for borrowed amount:', effectiveBorrowedAmount);
            if (effectiveBorrowedAmount < SLAB_1_MAX || Math.abs(effectiveBorrowedAmount - SLAB_1_MAX) < 0.01) {
                interestRate = 12.49;  // Slab 1: Up to ₹5,00,000
                console.log('Interest rate determined: Slab 1 (12.49%)');
            } 
            else if (effectiveBorrowedAmount > SLAB_1_MAX && effectiveBorrowedAmount <= SLAB_2_MAX) {
                interestRate = 13.49;  // Slab 2: ₹5,00,000.01 to ₹10,00,000
                console.log('Interest rate determined: Slab 2 (13.49%)');
            } 
            else if (effectiveBorrowedAmount > SLAB_2_MAX && effectiveBorrowedAmount <= SLAB_3_MAX) {
                interestRate = 14.49;  // Slab 3: ₹10,00,000.01 to ₹25,00,000
                console.log('Interest rate determined: Slab 3 (14.49%)');
            } 
            else if (effectiveBorrowedAmount > SLAB_3_MAX && effectiveBorrowedAmount <= SLAB_4_MAX) {
                interestRate = 15.49;  // Slab 4: ₹25,00,000.01 to ₹50,00,000
                console.log('Interest rate determined: Slab 4 (15.49%)');
            } 
            else {
                interestRate = 16.49;  // Slab 5: Above ₹50,00,000
                console.log('Interest rate determined: Slab 5 (16.49%)');
            }
        }
    }
    
    // Update the summary section
    document.getElementById('totalInvestment').textContent = '₹' + totalInvestment.toLocaleString('en-IN', {maximumFractionDigits: 0});
    document.getElementById('fundedAmount').textContent = '₹' + fundedAmount.toLocaleString('en-IN', {maximumFractionDigits: 0});
    
    // Add effective borrowing information to summary
    document.getElementById('effectiveBorrowedAmount').textContent = '₹' + effectiveBorrowedAmount.toLocaleString('en-IN', {maximumFractionDigits: 0});
    document.getElementById('leftoverBalance').textContent = '₹' + leftoverBalance.toLocaleString('en-IN', {maximumFractionDigits: 0});
    
    // Calculate additional money needed to reduce the MTF rate
    let amountToReduceRate = 0;
    let rateReductionRow = document.querySelector('.rate-reduction-row');
    
    if (effectiveBorrowedAmount > 0) {
        if (effectiveBorrowedAmount > SLAB_4_MAX) {
            // From Slab 5 (>50L) to Slab 4 (25-50L)
            amountToReduceRate = effectiveBorrowedAmount - SLAB_4_MAX;
        } else if (effectiveBorrowedAmount > SLAB_3_MAX) {
            // From Slab 4 (25-50L) to Slab 3 (10-25L)
            amountToReduceRate = effectiveBorrowedAmount - SLAB_3_MAX;
        } else if (effectiveBorrowedAmount > SLAB_2_MAX) {
            // From Slab 3 (10-25L) to Slab 2 (5-10L)
            amountToReduceRate = effectiveBorrowedAmount - SLAB_2_MAX;
        } else if (effectiveBorrowedAmount > SLAB_1_MAX) {
            // From Slab 2 (5-10L) to Slab 1 (0-5L)
            amountToReduceRate = effectiveBorrowedAmount - SLAB_1_MAX;
        } else if (effectiveBorrowedAmount <= SLAB_1_MAX) {
            // From Slab 1 (0-5L) to 0% (no borrowing)
            amountToReduceRate = effectiveBorrowedAmount;
        }
    }
    
    // Display or hide the rate reduction row
    if (amountToReduceRate > 0) {
        const rateReductionAmount = document.getElementById('rateReductionAmount');
        rateReductionRow.style.display = 'table-row';
        rateReductionAmount.textContent = '₹' + amountToReduceRate.toLocaleString('en-IN', {maximumFractionDigits: 0});
        
        // Add next tier rate information
        let nextTierRate = 0;
        if (effectiveBorrowedAmount > SLAB_4_MAX) {
            nextTierRate = 15.49;
        } else if (effectiveBorrowedAmount > SLAB_3_MAX) {
            nextTierRate = 14.49;
        } else if (effectiveBorrowedAmount > SLAB_2_MAX) {
            nextTierRate = 13.49;
        } else if (effectiveBorrowedAmount > SLAB_1_MAX) {
            nextTierRate = 12.49;
        } else {
            nextTierRate = 0;
        }
        
        rateReductionAmount.innerHTML += ` <span style="font-size:0.9em;">(to ${nextTierRate}%)</span>`;
    } else {
        if (rateReductionRow) {
            rateReductionRow.style.display = 'none';
        }
    }
    
    document.getElementById('quantity').textContent = quantity.toLocaleString('en-IN', {maximumFractionDigits: 0});
    document.getElementById('interestRate').textContent = interestRate.toFixed(2) + '%';
    document.getElementById('otherChargesDisplay').textContent = '₹' + otherCharges.toLocaleString('en-IN', {maximumFractionDigits: 2});
    document.getElementById('resultSummary').style.display = 'block';
    
    // Create period selectors (days or months)
    let periodButtonsHTML = '';
    const defaultPeriod = isDayMode ? 5 : Math.min(6, maxPeriod);
    
    if (isDayMode) {
        // For day mode, only show key days: 1, 5, 10, 15, 20, 25, 30
        const keyDays = [1, 5, 10, 15, 20, 25, 30];
        for (let i = 0; i < keyDays.length; i++) {
            // Only include days that are within the max period
            if (keyDays[i] <= maxPeriod) {
                periodButtonsHTML += `<button id="period-${keyDays[i]}" class="month-btn ${keyDays[i] === defaultPeriod ? 'active' : ''}" onclick="selectMonth(${keyDays[i]})">${keyDays[i]}</button>`;
            }
        }
    } else {
        // For month mode, show all months 1-12 (or whatever max is)
        for (let i = 1; i <= maxPeriod; i++) {
            periodButtonsHTML += `<button id="period-${i}" class="month-btn ${i === defaultPeriod ? 'active' : ''}" onclick="selectMonth(${i})">${i}</button>`;
        }
    }
    document.getElementById('monthSelector').innerHTML = periodButtonsHTML;
    
    // Calculate for each period and store results
    let resultHTML = "";
    calculationResults = [];
    
    for (let period = 1; period <= maxPeriod; period++) {
        // Calculate MTF charges based on days or months
        let mtfCharges;
        if (isDayMode) {
            // Daily charges (annual rate / 365 * days)
            mtfCharges = (effectiveBorrowedAmount > 0) ? (effectiveBorrowedAmount * (interestRate / 100) / 365) * period : 0;
        } else {
            // Monthly charges (annual rate / 12 * months)
            mtfCharges = (effectiveBorrowedAmount > 0) ? (effectiveBorrowedAmount * (interestRate / 100) / 12) * period : 0;
        }
        
        const gst = mtfCharges * 0.18;
        const totalCosts = mtfCharges + gst + otherCharges;
        const grossProfit = (sellPrice - buyPrice) * quantity;
        const paperProfit = grossProfit - mtfCharges;
        const netProfit = paperProfit - otherCharges - gst;
        const returnPercent = (netProfit / ownAmount) * 100;
        const breakevenPrice = buyPrice + (totalCosts / quantity);
        
        // Store results for each period
        calculationResults.push({
            period: period,
            mtfCharges: mtfCharges,
            gst: gst,
            grossProfit: grossProfit,
            paperProfit: paperProfit,
            netProfit: netProfit,
            returnPercent: returnPercent,
            breakevenPrice: breakevenPrice,
            leverage: leverage,
            ownAmount: ownAmount,
            totalBalance: totalBalance,
            leftoverBalance: leftoverBalance,
            effectiveBorrowedAmount: effectiveBorrowedAmount,
            interestRate: interestRate,
            tradeValue: tradeValue,
            fundedAmount: fundedAmount,
            totalInvestment: totalInvestment,
            quantity: quantity,
            otherCharges: otherCharges,
            noLeverageNetProfit: noLeverageNetProfit,
            noLeverageReturnPercent: noLeverageReturnPercent,
        });
        
        const profitClass = netProfit >= 0 ? 'profit' : 'loss';
        
        // Add leverage column data if leverage > 1
        let leverageColumnTd = '';
        if (leverage > 1) {
            const noLeverageProfitClass = noLeverageNetProfit >= 0 ? 'profit' : 'loss';
            
            // Generate the advantage HTML with proper color coding
            const advantageHTML = generateAdvantageHTML(returnPercent, noLeverageReturnPercent);
            
            // For first row, show both the no-leverage result and the advantage calculation
            if (period === 1) {
                leverageColumnTd = `<td class="leverage-column show">
                    <span class="${noLeverageProfitClass}">₹${noLeverageNetProfit.toLocaleString('en-IN', {maximumFractionDigits: 2})} (${noLeverageReturnPercent.toLocaleString('en-IN', {maximumFractionDigits: 2})}%)</span>
                    <span class="separator">||</span> 
                    ${advantageHTML}
                </td>`;
                
                // Update the summary section displays
                const noLeverageDisplay = document.getElementById('noLeverageDisplay');
                noLeverageDisplay.innerHTML = `₹${noLeverageNetProfit.toLocaleString('en-IN', {maximumFractionDigits: 2})} (${noLeverageReturnPercent.toLocaleString('en-IN', {maximumFractionDigits: 2})}%)`;
                noLeverageDisplay.className = noLeverageProfitClass;
                
                // Update the leverage advantage display
                const leverageDiffDisplay = document.getElementById('leverageDiffDisplay');
                leverageDiffDisplay.innerHTML = advantageHTML;
            } else {
                // For other rows, just show the advantage calculation
                leverageColumnTd = `<td class="leverage-column show">${advantageHTML}</td>`;
            }
        }
        
        resultHTML += `<tr>
            <td>${period}</td>
            <td>₹${mtfCharges.toLocaleString('en-IN', {maximumFractionDigits: 2})}</td>
            <td>₹${gst.toLocaleString('en-IN', {maximumFractionDigits: 2})}</td>
            <td>${period === 1 ? '₹' + otherCharges.toLocaleString('en-IN', {maximumFractionDigits: 2}) : '-'}</td>
            ${leverageColumnTd}
            <td>₹${grossProfit.toLocaleString('en-IN', {maximumFractionDigits: 2})}</td>
            <td>₹${paperProfit.toLocaleString('en-IN', {maximumFractionDigits: 2})}</td>
            <td class="${profitClass}">₹${netProfit.toLocaleString('en-IN', {maximumFractionDigits: 2})}</td>
            <td class="${profitClass}">${returnPercent.toLocaleString('en-IN', {maximumFractionDigits: 2})}%</td>
        </tr>`;
    }
    
    document.getElementById('result').innerHTML = resultHTML;
    
    // Select the default period
    selectMonth(defaultPeriod);
    
    // Update the current rate display to match the calculated interest rate
    if (!customRateToggle.checked) {
        currentRateDisplay.textContent = `Current Rate: ${interestRate}%`;
    }
}

function resetForm() {
    document.getElementById('ownAmount').value = 100000;
    document.getElementById('buyPrice').value = 100;
    document.getElementById('sellPrice').value = 105;
    document.getElementById('leverage').value = 5;
    document.getElementById('totalBalance').value = 500000;
    document.getElementById('maxPeriod').value = 12;
    document.getElementById('customRateToggle').checked = false;
    document.getElementById('customRate').value = 12.49;
    document.getElementById('dayModeToggle').checked = false;
    document.getElementById('maxPeriodLabel').textContent = 'Max Months:';
    document.querySelector('#tableHeader th:first-child').textContent = 'Month';
    document.querySelector('.table-container').style.maxHeight = '400px'; // Reset to original height
    customRateContainer.style.display = 'none';
    document.getElementById('resultSummary').style.display = 'none';
    document.getElementById('result').innerHTML = '';
    document.getElementById('monthSelector').innerHTML = '';
    leverageColumnHeader.classList.remove('show');
    document.getElementById('noLeverageRow').style.display = 'none';
    document.getElementById('diffRow').style.display = 'none';
    
    // Reset global variables
    noLeverageReturnPercent = 0;
    noLeverageNetProfit = 0;
    
    // Reset amount display
    const amountDisplay = document.getElementById('amountDisplay');
    if (amountDisplay) {
        amountDisplay.textContent = '';
        // Trigger update to show default amount
        updateAmountDisplay();
    }
    
    // Reset total balance display
    const totalBalanceDisplay = document.getElementById('totalBalanceDisplay');
    if (totalBalanceDisplay) {
        totalBalanceDisplay.textContent = '';
        // Trigger update to show default total balance
        updateTotalBalanceDisplay();
    }
    
    // Reset interest rate display to 0% (for 1x leverage)
    updateInterestRateDisplay();
    
    calculationResults = [];
}

    </script>
</body>
</html>
